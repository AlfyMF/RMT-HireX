datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model JobType {
  id          String   @id @default(uuid())
  name        String   @unique @db.VarChar(25)
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  isActive    Boolean  @default(true) @map("is_active")
  
  jobRequisitions JobRequisition[]

  @@map("JobType")
}

model Certification {
  id                  String   @id @default(uuid())
  name                String   @unique @db.VarChar(255)
  issuingOrganization String   @db.VarChar(255) @map("issuing_organization")
  description         String?  @db.Text
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  isActive            Boolean  @default(true) @map("is_active")

  @@index([issuingOrganization])
  @@map("Certification")
}

model Country {
  id        String   @id @default(uuid())
  name      String   @unique @db.VarChar(255)
  code      String   @unique @db.VarChar(3)
  phoneCode String?  @db.VarChar(5) @map("phone_code")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isActive  Boolean  @default(true) @map("is_active")
  
  officeLocations OfficeLocation[]
  jobRequisitions JobRequisition[]

  @@index([phoneCode])
  @@map("Country")
}

model Department {
  id            String   @id @default(uuid())
  name          String   @unique @db.VarChar(255)
  code          String   @unique @db.VarChar(255)
  description   String?  @db.Text
  duHead        String?  @db.VarChar(36) @map("du_head")
  cdo           String?  @db.VarChar(36)
  recruiterLead String?  @db.VarChar(36) @map("recruiter_lead")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  isActive      Boolean  @default(true) @map("is_active")
  
  duHeadUser        User? @relation("DepartmentDUHead", fields: [duHead], references: [id], onDelete: Cascade, onUpdate: Cascade)
  cdoUser           User? @relation("DepartmentCDO", fields: [cdo], references: [id], onDelete: Cascade, onUpdate: Cascade)
  recruiterLeadUser User? @relation("DepartmentRecruiterLead", fields: [recruiterLead], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  users           User[] @relation("UserDepartment")
  jobRequisitions JobRequisition[]

  @@index([code])
  @@index([duHead])
  @@index([cdo])
  @@index([recruiterLead])
  @@map("Department")
}

model JobTitle {
  id          String   @id @default(uuid())
  title       String   @unique @db.VarChar(255)
  description String?  @db.Text
  level       Int?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  isActive    Boolean  @default(true) @map("is_active")
  
  jobRequisitions JobRequisition[]

  @@index([level])
  @@map("JobTitle")
}

model Qualification {
  id          String   @id @default(uuid())
  name        String   @unique @db.VarChar(255)
  level       String?  @db.VarChar(255)
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  isActive    Boolean  @default(true) @map("is_active")

  @@index([level])
  @@map("Qualification")
}

model Role {
  id          String   @id @default(uuid())
  name        String   @unique @db.VarChar(255)
  description String?  @db.Text
  permissions Json?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  isActive    Boolean  @default(true) @map("is_active")
  
  users User[]

  @@map("Role")
}

model Skill {
  id         String   @id @default(uuid())
  name       String   @unique @db.VarChar(255)
  category   String?  @db.VarChar(255)
  isTechnical Boolean @default(true) @map("is_technical")
  importance String   @default("primary") @db.VarChar(20)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  isActive   Boolean  @default(true) @map("is_active")

  jobRequisitions JobRequisition[]

  @@index([category, isTechnical])
  @@index([importance])
  @@index([isTechnical])
  @@map("Skill")
}

model OfficeLocation {
  id        String   @id @default(uuid())
  name      String   @unique @db.VarChar(255)
  address   String   @db.Text
  countryId String   @db.VarChar(36) @map("country_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isActive  Boolean  @default(true) @map("is_active")
  
  country                    Country            @relation(fields: [countryId], references: [id], onDelete: Cascade)
  jobRequisitionsOnsiteLocation JobRequisition[]

  @@index([countryId])
  @@map("OfficeLocation")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique @db.VarChar(255)
  name          String?   @db.VarChar(255)
  role          String    @db.VarChar(50)
  roleId        String?   @db.VarChar(36) @map("role_id")
  departmentId  String?   @db.VarChar(36) @map("department_id")
  deactivatedAt DateTime? @map("deactivated_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  isActive      Boolean   @default(true) @map("is_active")
  
  roleRef    Role?       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  department Department? @relation("UserDepartment", fields: [departmentId], references: [id], onDelete: Cascade)
  
  departmentsAsDUHead        Department[] @relation("DepartmentDUHead")
  departmentsAsCDO           Department[] @relation("DepartmentCDO")
  departmentsAsRecruiterLead Department[] @relation("DepartmentRecruiterLead")
  
  jobRequisitionsRequestedBy   JobRequisition[] @relation("JRRequestedBy")
  jobRequisitionsHiringManager JobRequisition[] @relation("JRHiringManager")
  jobRequisitionsRecruiterLead JobRequisition[] @relation("JRRecruiterLead")
  jobRequisitionsRecruiterPoc  JobRequisition[] @relation("JRRecruiterPoc")
  jobRequisitionsSubmitter     JobRequisition[] @relation("JRSubmitter")

  @@index([email, isActive])
  @@index([departmentId])
  @@map("User")
}

model VisaStatus {
  id           String   @id @default(uuid())
  status       String   @unique @db.VarChar(255)
  description  String?  @db.Text
  isWorkPermit Boolean  @default(false) @map("is_work_permit")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  isActive     Boolean  @default(true) @map("is_active")

  @@index([isWorkPermit])
  @@map("VisaStatus")
}

model WorkShift {
  id          String   @id @default(uuid())
  name        String   @unique @db.VarChar(255)
  startTime   String   @db.VarChar(8) @map("start_time")
  endTime     String   @db.VarChar(8) @map("end_time")
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  isActive    Boolean  @default(true) @map("is_active")

  jobRequisitions JobRequisition[]

  @@index([startTime, endTime])
  @@map("WorkShift")
}

model WorkTimeZone {
  id            String   @id @default(uuid())
  name          String   @unique @db.VarChar(255)
  description   String?  @db.Text
  timezoneValue String   @unique @db.VarChar(255) @map("timezone_value")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  isActive      Boolean  @default(true) @map("is_active")

  jobRequisitions JobRequisition[]

  @@map("WorkTimeZone")
}

model JobRequisition {
  // Core Identification & Status
  id          String   @id @default(uuid())
  jrId        String   @unique @db.VarChar(50) @map("jr_id")
  jrStatus    String   @default("Draft") @db.VarChar(50) @map("jr_status")
  submittedBy String?  @db.VarChar(36) @map("submitted_by")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Basic Details (Step 1)
  workArrangement                String   @db.VarChar(50) @map("work_arrangement")
  jobTypeId                      String   @db.VarChar(36) @map("job_type_id")
  coreSkillId                    String?  @db.VarChar(36) @map("core_skill_id")
  jobTitleId                     String   @db.VarChar(36) @map("job_title_id")
  requestedDate                  DateTime? @map("requested_date")
  departmentId                   String   @db.VarChar(36) @map("department_id")
  requestedById                  String   @db.VarChar(36) @map("requested_by_id")
  hiringManagerId                String   @db.VarChar(36) @map("hiring_manager_id")
  numberOfPositions              Int      @default(1) @map("number_of_positions")
  expectedDateOfOnboardingStart  DateTime? @map("expected_date_of_onboarding_start")
  expectedDateOfOnboardingEnd    DateTime? @map("expected_date_of_onboarding_end")
  idealStartDateStart            DateTime? @map("ideal_start_date_start")
  idealStartDateEnd              DateTime? @map("ideal_start_date_end")
  billable                       Boolean  @default(false)
  clientBillingRate              Decimal? @db.Decimal(15, 2) @map("client_billing_rate")
  totalBudgetMin                 Decimal? @db.Decimal(15, 2) @map("total_budget_min")
  totalBudgetMax                 Decimal? @db.Decimal(15, 2) @map("total_budget_max")
  expectedSalaryMin              Decimal? @db.Decimal(15, 2) @map("expected_salary_min")
  expectedSalaryMax              Decimal? @db.Decimal(15, 2) @map("expected_salary_max")

  // Skills & Qualifications (Step 2)
  primarySkills         String[] @default([]) @map("primary_skills")
  secondarySkills       String[] @default([]) @map("secondary_skills")
  niceToHaveSkills      String[] @default([]) @map("nice_to_have_skills")
  qualifications        String[] @default([])
  certifications        String[] @default([])
  specificQualification String?  @db.VarChar(255) @map("specific_qualification")
  totalExperienceMin    Decimal? @db.Decimal(5, 2) @map("total_experience_min")
  totalExperienceMax    Decimal? @db.Decimal(5, 2) @map("total_experience_max")
  relevantExperienceMin Decimal? @db.Decimal(5, 2) @map("relevant_experience_min")
  relevantExperienceMax Decimal? @db.Decimal(5, 2) @map("relevant_experience_max")

  // Project & Client (Step 3)
  projectName      String?  @db.VarChar(255) @map("project_name")
  projectRole      String?  @db.VarChar(255) @map("project_role")
  clientName       String?  @db.VarChar(255) @map("client_name")
  clientCountryId  String?  @db.VarChar(36) @map("client_country_id")
  clientInterview  Boolean  @default(false) @map("client_interview")

  // Location & Shift (Step 4)
  workLocations       String[] @default([]) @map("work_locations")
  workShiftId         String?  @db.VarChar(36) @map("work_shift_id")
  shiftTime           String?  @db.VarChar(100) @map("shift_time")
  onsiteWorkMode      String?  @db.VarChar(50) @map("onsite_work_mode")
  onsiteLocationId    String?  @db.VarChar(36) @map("onsite_location_id")
  onsiteDaysPerWeek   Int?     @map("onsite_days_per_week")
  preferredTimeZoneId String?  @db.VarChar(36) @map("preferred_time_zone_id")

  // Job Description (Step 5)
  jobPurpose       String? @db.Text @map("job_purpose")
  primaryDuties    String? @db.Text @map("primary_duties")
  goodToHaveDuties String? @db.Text @map("good_to_have_duties")
  jobSpecification String? @db.Text @map("job_specification")

  // Onsite-Specific (Step 6)
  rate             Decimal? @db.Decimal(15, 2)
  rateUnit         String?  @db.VarChar(50) @map("rate_unit")
  rateCurrency     String?  @db.VarChar(10) @map("rate_currency")
  paymentCycle     String?  @db.VarChar(50) @map("payment_cycle")
  visaStatuses     String[] @default([]) @map("visa_statuses")
  contractDuration String?  @db.VarChar(50) @map("contract_duration")
  durationUnit     String?  @db.VarChar(20) @map("duration_unit")
  reportingManager String?  @db.VarChar(255) @map("reporting_manager")
  interviewProcess String?  @db.Text @map("interview_process")
  h1Transfer       Boolean  @default(false) @map("h1_transfer")
  travelRequired   Boolean  @default(false) @map("travel_required")

  // Additional Required Fields
  recruiterLeadId String? @db.VarChar(36) @map("recruiter_lead_id")
  recruiterPocId  String? @db.VarChar(36) @map("recruiter_poc_id")

  // Foreign Key Relations
  jobType           JobType         @relation(fields: [jobTypeId], references: [id])
  coreSkill         Skill?          @relation(fields: [coreSkillId], references: [id])
  jobTitle          JobTitle        @relation(fields: [jobTitleId], references: [id])
  department        Department      @relation(fields: [departmentId], references: [id])
  requestedBy       User            @relation("JRRequestedBy", fields: [requestedById], references: [id])
  hiringManager     User            @relation("JRHiringManager", fields: [hiringManagerId], references: [id])
  clientCountry     Country?        @relation(fields: [clientCountryId], references: [id])
  workShift         WorkShift?      @relation(fields: [workShiftId], references: [id])
  onsiteLocation    OfficeLocation? @relation(fields: [onsiteLocationId], references: [id])
  preferredTimeZone WorkTimeZone?   @relation(fields: [preferredTimeZoneId], references: [id])
  recruiterLead     User?           @relation("JRRecruiterLead", fields: [recruiterLeadId], references: [id])
  recruiterPoc      User?           @relation("JRRecruiterPoc", fields: [recruiterPocId], references: [id])
  submitter         User?           @relation("JRSubmitter", fields: [submittedBy], references: [id])

  // Indexes for Performance
  @@index([jrStatus])
  @@index([departmentId])
  @@index([requestedById])
  @@index([hiringManagerId])
  @@index([workArrangement])
  @@index([createdAt])
  @@index([updatedAt])
  @@index([jrId])
  @@map("JobRequisition")
}
